Все проверки в main().

Задания со звездочкой сделаны с применением ИИ, чтобы сохранить себе решение на будущее.
Просто завал по работе, куча "хвостов" висит.